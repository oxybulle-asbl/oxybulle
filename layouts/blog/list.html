{{ define "main" }}
  {{ partial "page-header" . }}

  <section class="section">
    <div class="container">
      <div class="row justify-center">
        <div class="lg:col-10 xl:col-8">
          
          <!-- Filtres par catÃ©gorie -->
          <div class="metro-filters mb-8">
            <div class="filter-buttons">
              <button class="filter-btn active" data-filter="all">
                <span class="filter-emoji">ðŸŒŸ</span>
                Tout
              </button>
              <button class="filter-btn" data-filter="infolettre">
                <span class="filter-emoji">ðŸ“¨</span>
                Infolettres
              </button>
              <button class="filter-btn" data-filter="evenement">
                <span class="filter-emoji">ðŸŽ­</span>
                Ã‰vÃ¨nements
              </button>
              <button class="filter-btn" data-filter="action">
                <span class="filter-emoji">ðŸŽˆ</span>  
                Actions
              </button>
              </button>
              <button class="filter-btn" data-filter="presse">
                <span class="filter-emoji">ðŸ“°</span>
                Presse
              </button>

            </div>
          </div>
          
          <div class="metro-timeline">
            {{ $paginator := .Paginate .RegularPages }}
            
            <!-- Liste des stations mÃ©tro -->
            <div class="metro-line">
              {{ range $index, $page := $paginator.Pages }}
                {{ $colorIndex := mod $index 4 }}
                {{ $lineClass := "" }}
                {{ if eq $colorIndex 0 }}
                  {{ $lineClass = "metro-line-primary" }}
                {{ else if eq $colorIndex 1 }}
                  {{ $lineClass = "metro-line-green" }}
                {{ else if eq $colorIndex 2 }}
                  {{ $lineClass = "metro-line-yellow" }}
                {{ else }}
                  {{ $lineClass = "metro-line-orange" }}
                {{ end }}
                
                {{ $category := "other" }}
                {{ if $page.Params.categories }}
                  {{ $category = index $page.Params.categories 0 | lower }}
                {{ end }}
                
                <div class="metro-station {{ $lineClass }}" data-line="{{ add $colorIndex 1 }}" data-category="{{ $category }}">
                  
                  <!-- Station circle avec date -->
                  <div class="metro-station-circle">
                    <div class="metro-date">
                      <span class="metro-day">{{ $page.Date.Format "02" }}</span>
                      <span class="metro-month">
                        {{ $page.Date.Format "Jan" | replaceRE "Jan" "JAN" | replaceRE "Feb" "FEV" | replaceRE "Mar" "MAR" | replaceRE "Apr" "AVR" | replaceRE "May" "MAI" | replaceRE "Jun" "JUN" | replaceRE "Jul" "JUL" | replaceRE "Aug" "AOU" | replaceRE "Sep" "SEP" | replaceRE "Oct" "OCT" | replaceRE "Nov" "NOV" | replaceRE "Dec" "DEC" }}
                      </span>
                      <span class="metro-year">{{ $page.Date.Format "06" }}</span>
                    </div>
                  </div>
                  
                  <!-- Contenu de la station -->
                  <div class="metro-station-content">
                    <div class="metro-station-info">
                      <!-- Titre avec emoji et icÃ´nes -->
                      <h3 class="metro-station-name">
                        <!-- Emoji selon la catÃ©gorie (non cliquable) -->
                        {{ if $page.Params.categories }}
                          {{ if eq $category "action" }}
                            <span class="metro-emoji">ðŸ“Œ</span>
                          {{ else if eq $category "evenement" }}
                            <span class="metro-emoji">ðŸŽ­</span>
                          {{ else if eq $category "infolettre" }}
                            <span class="metro-emoji">ðŸ“œ</span>
                          {{ else if eq $category "presse"}}
                            <span class="metro-emoji">ðŸ“°</span>
                          {{ else }}
                            <span class="metro-emoji">ðŸ“„</span>
                          {{ end }}
                        {{ end }}
                        
                        <!-- Titre cliquable -->
                        <a 
                          href="{{ $page.Params.external_link | default $page.Permalink }}" 
                          class="metro-link"
                          {{ if $page.Params.external_link }}target="_blank" rel="noopener"{{ end }}
                          title="{{ $page.Title }}"
                        >
                          {{ $page.Title }}
                          {{ if $page.Params.external_link }}
                            <span class="metro-external-icon">â†—</span>
                          {{ end }}
                        </a>
                        
                        <!-- Bouton copie Ã  cÃ´tÃ© -->
                        <button 
                          class="metro-copy-icon" 
                          data-url="{{ $page.Params.external_link | default $page.Permalink }}"
                          title="Copier le lien"
                        >
                          â§‰
                        </button>
                      </h3>
                      
                      <!-- Description -->
                      {{ if $page.Content }}
                        {{ $content := $page.Content | plainify | truncate 200 "..." }}
                        {{ if $content }}
                          <span class="metro-description">
                            {{ $content }}
                          </span>
                        {{ end }}
                      {{ end }}
                    </div>
                  </div>
                </div>
              {{ end }}
            </div>
          </div>
          
          <!-- Pagination -->
          {{ if gt $paginator.TotalPages 1 }}
            <div class="mt-16">
              {{ partial "components/pagination.html" . }}
            </div>
          {{ end }}
        </div>
      </div>
    </div>
  </section>

  <!-- JavaScript pour les filtres et la copie -->
  <script>
    // Filtres par catÃ©gorie
    document.addEventListener('DOMContentLoaded', function() {
      const filterButtons = document.querySelectorAll('.filter-btn');
      const stations = document.querySelectorAll('.metro-station');
      
      filterButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Mise Ã  jour des boutons actifs
          filterButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const filter = this.getAttribute('data-filter');
          
          // Filtrage des stations
          stations.forEach(station => {
            const category = station.getAttribute('data-category');
            if (filter === 'all' || category === filter) {
              station.style.display = 'flex';
              setTimeout(() => {
                station.style.opacity = '1';
                station.style.transform = 'translateX(0)';
              }, 50);
            } else {
              station.style.opacity = '0';
              station.style.transform = 'translateX(-20px)';
              setTimeout(() => {
                station.style.display = 'none';
              }, 300);
            }
          });
        });
      });
      
      // Boutons de copie
      const copyButtons = document.querySelectorAll('.metro-copy-icon');
      
      copyButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const url = this.getAttribute('data-url');
          
          navigator.clipboard.writeText(url).then(() => {
            // Feedback visuel
            const originalText = this.textContent;
            this.textContent = 'âœ“';
            
            setTimeout(() => {
              this.textContent = originalText;
            }, 1500);
          }).catch(() => {
            // Fallback pour navigateurs plus anciens
            const tempInput = document.createElement('input');
            tempInput.value = url;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            // Feedback visuel
            const originalText = this.textContent;
            this.textContent = 'âœ“';
            
            setTimeout(() => {
              this.textContent = originalText;
            }, 1500);
          });
        });
      });
    });
  </script>
{{ end }}